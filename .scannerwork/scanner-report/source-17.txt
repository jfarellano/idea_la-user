const r = require('axios');
import api from './requests'

function getHeaders() {
    return { headers: { "Authorization": 'Token token=' + localStorage.getItem('secret') } }
}

export default {
    session: {
        login: function (body) {
            return r.post(api.variable.URL + '/sessions', body)
        },
        logout: function () {
            return r.delete(api.variable.URL + '/sessions', getHeaders())
        },
        user_info(user_id){
            return r.get(api.variable.URL + '/users/' + user_id)
        }
    },
    storage: {
        set: function (user_id, secret, expire) {
            localStorage.setItem('user_id', user_id)
            localStorage.setItem('secret', secret)
            localStorage.setItem('expire', expire)
        },
        set_name: function (name, lastname) {
            const nameCapitalized =
                name.charAt(0).toUpperCase() +
                name.slice(1);
            const lastnameCapitalized =
                lastname.charAt(0).toUpperCase() +
                lastname.slice(1);
            localStorage.setItem('name', nameCapitalized + " " + lastnameCapitalized)
        },
        loged: function () {
            if (localStorage.getItem('secret') != null) {
                var exp = new Date(localStorage.getItem('expire'))
                if (exp > Date.now()){
                    return true
                }else{
                    localStorage.clear()
                    return false
                }
            } else {
                return false
            }
        },
        get: function (name) {
            return localStorage.getItem(name)
        },
        clear: function(){
            localStorage.clear()
        }
    }
}